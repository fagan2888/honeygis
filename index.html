<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=1024, user-scalable=no">
<style>
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0;}
      #map{ height: 100% }
</style>

<script src="http://code.jquery.com/jquery-1.9.1.js" type="text/javascript"></script>
<script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="colorbrewer.js"></script>
<script src="hexbin.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
<script src="bayvis.js"></script>

<title>HoneyGIS</title>

<script type="text/javascript">
config = {
   csvfname: null,
   colorscheme: "YlGnBu",
   buckets: 9,
   quantile: false,
   opacity: .7,
   radius: .0040,
   agg: d3.mean,
   field: "walkprob"
}
data = {
}

$(document).ready(function() {
 
  initmap(); 

  for(var key in colorbrewer) {
    var option=document.createElement("option");
    option.text=key;
    document.getElementById("colorselect").add(option,null);
  }

  $("#colorchooser").change(function(s) {
      config["colorscheme"] = $("#colorchooser").find(":selected").text();
      colormap(data,config);
  });
  $("#quantilechooser").change(function(s) {
      config["quantile"] = ($("#quantilechooser").find(":selected").text() == "True");
      colormap(data,config);
  });
  $("#bucketschooser").change(function(s) {
      config["buckets"] = Number($("#bucketschooser").find(":selected").text());
      colormap(data,config);
  });
  $("#filechooser").change(function(s) {
      function updatefields(fname) {
        $("#fieldselect").empty();
        var option=document.createElement("option");
        option.text="choose...";
        option.value="temporary";
        document.getElementById("fieldselect").add(option,null);
        for(var key in data[fname][0]) {
          var option=document.createElement("option");
          option.text=key;
          document.getElementById("fieldselect").add(option,null);
        }
        config["csvfname"] = fname;
      }
      var fname = $("#filechooser").find(":selected").text();
      if(fname != "" && !(fname in data)) {
        d3.text(fname, function(contents) {
          data[fname] = d3.csv.parse(contents);
          updatefields(fname);
        });
      } else {
          updatefields(fname);
      }
  });
  $("#fieldchooser").change(function(s) {
      config["field"] = $("#fieldchooser").find(":selected").text();
      $("#fieldchooser option[value='temporary']").remove();
      colormap(data,config);
  });
  $("#radiuschooser").change(function(s) {
      config["radius"] = parseFloat($("#radiuschooser").find(":selected").text());
      colormap(data,config);
  });
  $("#opacitychooser").change(function(s) {
      config["opacity"] = parseFloat($("#opacitychooser").find(":selected").text());
      colormap(data,config);
  });
  $("#aggchooser").change(function(s) {
      config["agg"] = eval("d3."+$("#aggchooser").find(":selected").text());
      colormap(data,config);
  });
});
</script>
</head>
<body> 
<div id="map" style="width:100%; height:100%; position:fixed; left:0; top:0; overflow:hidden;"></div>
<div id="filechooser" style="position:absolute; right: 15px; top: 15px;">
<select id="fileselect" style="width: 100px;">
<option></option>
<option>nodes.csv</option>
<option>nodesall.csv</option>
</select>
</div>
<div id="fieldchooser" style="position:absolute; right: 15px; top: 40px;">
<select id="fieldselect" style="width: 100px;">
</select>
</div>
<div id="colorchooser" style="position:absolute; right: 15px; top: 65px;">
<select id="colorselect" style="width: 100px;">
</select>
</div>
<div id="quantilechooser" style="position:absolute; right: 15px; top: 90px;">
<select style="width: 100px;">
    <option>False</option>
    <option>True</option>
</select>
</div>
<div id="bucketschooser" style="position:absolute; right: 15px; top: 115px;">
<select style="width: 100px;">
    <option>3</option>
    <option>5</option>
    <option>7</option>
    <option selected>9</option>
</select>
</div>
<div id="radiuschooser" style="position:absolute; right: 15px; top: 140px;">
<select style="width: 100px;">
    <option>.002</option>
    <option>.003</option>
    <option selected>.004</option>
    <option>.006</option>
    <option>.008</option>
    <option>.011</option>
    <option>.02</option>
</select>
</div>
<div id="aggchooser" style="position:absolute; right: 15px; top: 165px;">
<select style="width: 100px;">
    <option>min</option>
    <option>max</option>
    <option selected>mean</option>
    <option>median</option>
    <option>sum</option>
</select>
</div>
<div id="opacitychooser" style="position:absolute; right: 15px; top: 190px;">
<select style="width: 100px;">
    <option>.4</option>
    <option>.6</option>
    <option selected>.7</option>
    <option>.85</option>
</select>
</div>
</body>
